
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
    worker_connections 1024;
}

rtmp {
        server {
                listen 1935;
                chunk_size 4096;

                application live {
                        live on;
                        hls on;
                        hls_type live;
                        hls_path /tmp/hls;
                        hls_fragment 5s;
                        hls_playlist_length 30s;
                        hls_fragment_naming system;
                        deny play all;
                        record off;
                        #on_publish http://localhost:8000/auth
                }
        }
}

http {
        sendfile off;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65;
        types_hash_max_size 2048;
        server_tokens off;
        open_file_cache max=1000 inactive=20s;
        open_file_cache_valid 30s;
        open_file_cache_min_uses 5;
        open_file_cache_errors off;
        client_body_timeout 10;
        send_timeout 2;
        reset_timedout_connection on;

        default_type application/octet-stream;

        gzip on;

        server {
                location / {
                        root /var/www/html;
                }

                location /hls {
                        root /tmp;
                        add_header 'Cache-Control' no-cache;
                        add_header 'Access-Control-Allow-Origin' '*' always;
                        add_header 'Access-Control-Expose-Headers' 'Content-Length';
                        types {
                                application/vnd.apple.mpegurl m3u8;
                                video/mp2t ts;
                        }
                }
        }
}
